<!DOCTYPE html>
<html lang="ja">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>記録</title>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/app.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation" data-bind-tmpl-id="header" data-tmpl-src="./tmpl/tmpl.common.html">
        <div class="btn-toolbar" role="toolbar">
            <div class="btn-group" role="group" id="navMenu">
                <script type="text/tmpl" data-tmpl-id="navMenu" data-tmpl-option='{"render": true}'>
                    <button type="button" id="mapToggleButton" class="btn btn-default btn-xs fitAreaButton" data-event="##:findServiceModel.showSearchedMap##">
                        <span class="glyphicon glyphicon-map-marker">地図</span>
                    </button>
                    <button type="button" id="statisticsButton" class="btn btn-default btn-xs fitAreaButton" data-event="##:findServiceModel.showStatistics##">
                        <span class="glyphicon glyphicon-object-align-bottom">統計</span>
                    </button>
                </script>
            </div>

            <div class="btn-group" role="group" id="navMenuAdminButtons">
                <script type="text/tmpl" data-tmpl-id="navMenuAdminButtons" data-tmpl-option='{"render": false}'>
                    ##if(findServiceModel.getAuth(10)) {##
                    <button type="button" id="adminMapToggleButton" class="btn btn-default btn-xs fitAreaButton" data-toggle="collapse" data-event="##:findServiceModel.showAdminMap##">
                        <span class="glyphicon glyphicon-map-marker" aria-hidden="true">区域番号作業</span>
                    </button>
                    <button type="button" id="adminTableToggleButton" class="btn btn-default btn-xs fitAreaButton" data-event="##:adminTableModel.showAdminTable##">
                        <span class="glyphicon glyphicon-th-large" aria-hidden="true">区域管理</span>
                    </button>
                    <button type="button" class="btn btn-default btn-xs" data-event="##:{click:function(){refreshStorage();}}##">
                        <span class="glyphicon glyphicon-download-alt"></span> 区域データ
                    </button>
                    <button type="button" id="csvDownLoadButton" class="btn btn-default btn-xs" data-toggle="modal" data-target="#csvExportModal">
                        <span class="glyphicon glyphicon-download">CSV</span>
                    </button>
                    ##}
                    Bridge.tmplTool.render('csvExportModal', {});
                    ##
                </script>
            </div>
    </nav>
    
    <div class="container fitArea hidden" id="searchedMapArea" class="fitArea" style="height: 100%; position: absolute; height:calc(100% - 52px); width: 100%; margin-top: -18px;">
        <div id="searchedMap" style="height: 100%;">

        </div>
    </div>
    
    <div class="container fitArea hidden" id="statisticsArea" style="height: 100%; position: absolute; height:calc(100% - 52px); width: 100%; margin-top: -18px;">
        <div style="height: 100%;">
            <div class="row">
                <div id="chart1" class="col-sm-6" style="height:400px;"></div>
                <div id="chart2" class="col-sm-6" style="height:400px;"></div>
            </div>
            <div class="row">
                <div id="chart3" class="col-sm-6" style="height:600px;margin-top:20px;"></div>
                <div id="chart4" class="col-sm-6" style="height:600px;margin-top:20px;"></div>
            </div>
            
            <div id="statisticsDiv">
                <script type="text/tmpl" data-tmpl-id="statisticsDiv">
                    
                </script>
            </div>
        </div>
    </div>
    
    <div class="container fitArea hidden" id="adminTableArea" style="height: 100%; position: absolute; height:calc(100% - 52px); width: 100%; margin-top: 35px">
        <script type="text/tmpl" data-tmpl-id="adminTableArea">
            <div class="panel panel-default">
                <div class="panel-heading navbar-fixed-top" style="top:53px;">
                    区域作業
                    <!--
                    <button type="button" class="btn btn-default btn-sm pull-right" data-event="##:adminTableModel.resetCongregationAdminTable##">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 会衆リセット
                    </button>
                    -->
                    <button type="button" class="btn btn-default btn-sm pull-right" data-event="##:adminTableModel.resetFileno##">
                        <span class="glyphicon glyphicon-random" aria-hidden="true"></span> 区域番号リセット
                    </button>
                    <button type="button" class="btn btn-default btn-sm pull-right" data-event="##:{click:function(e) {$('#adminTableSearchArea').collapse('toggle');}}##">
                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span> 検索
                    </button>
                    <button type="button" class="btn btn-default btn-sm pull-right" data-event="##:{click:function(e) {$('#adminTableResultListArea').collapse('toggle');}}##">
                        <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span> 一覧
                    </button>
                </div>
        		<div class="panel-heading collapse" id="adminTableSearchArea">
            	    <div class="form-inline">
            		    ##
            		    $.each(findServiceModel_searchForm, function(key, obj) {
            		        if (obj.lineBreak) {
            		    ##
                	</div>
                	<div class="form-inline">
                		    ##}##
                        <div class="form-group">
                            <label class="">##=obj.label##</label>
                            <input type="##=obj.type || 'text'##" id="##=key##" list="##=obj.list##" value="##=data.search[key]##" class="form-control input-sm" style="##=obj.style##"/>
            			</div>
            		    ##});##
                		<div class="form-group">
                		    <select id="search_isNew" class="form-control input-sm" value="##=data.search.search_isNew##">
                		        <option value="">-新規有無-</option>
                    		        ##$.each(findServiceModel_isNew, function(key, obj) {##
                    		            <option value="##=key##" ##=data.search.search_isNew == key ? 'selected="selected"' : ""##>##=obj.label##</option>
                    		        ##});##
                            </select>
                        </div>
                		<div class="form-group">
                		    <select id="search_result" class="form-control input-sm" value="##=data.search.search_result##">
                		        <option value="">-結果-</option>
                		        ##$.each(findServiceModel_resultTypeModel, function(key, obj) {##
                		            <option value="##=key##" ##=data.search.search_result == key ? 'selected="selected"' : ""##>##=obj.label##</option>
                		        ##});##
                            </select>
                        </div>
                		<div class="form-group">
                		    <select id="search_findServiceCongStatus" class="form-control input-sm" value="##=data.search.search_findServiceCongStatus##">
                		        <option value="">-処理状況-</option>
                		        ##$.each(findServiceModel_findServiceCongStatus, function(key, obj) {##
                		            <option value="##=key##" ##=data.search.search_findServiceCongStatus == key ? 'selected="selected"' : ""##>##=obj.label##</option>
                		        ##});##
                            </select>
                        </div>

                		<button class="btn btn-default" type="submit" data-event="##:adminTableModel.searchAdminTable##">検索</button>
            		</div>
        		</div>

                <div type="text/tmpl" class="panel-body collapse" id="adminTableResultListArea" style="height:100px; overflow:auto;" data-tmpl-id="adminTableResultListArea">
                        <!--
                        ##
                        var congList = null;
                        for (var key in data.dataList) {
                            congList = data.dataList[key];
                            //console.log(key);
                        ##
                        -->
                        
                        <table class="table table-bordered table-striped">
                            <CAPTION>
                                ##=key##
                                <div class="btn-group pull-right">
                                    <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        処理状態を変更 <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a href="javascript:void(0);" data-event="##:adminTableModel.congSetStatus::[key,'ダウンロード済み']##">ダウンロード済み</a></li>
                                        <li><a href="javascript:void(0);" data-event="##:adminTableModel.congSetStatus::[key,'地元会衆へ連絡']##">地元会衆へ連絡</a></li>
                                        <li><a href="javascript:void(0);" data-event="##:adminTableModel.congSetStatus::[key,'処理完了']##">処理完了</a></li>
                                        <li><a href="javascript:void(0);" data-event="##:adminTableModel.congSetStatus::[key,'ステータスをクリア']##">ステータスをクリア</a></li>
                                    </ul>
                                </div>
                                <div class="btn-group pull-right" role="group">
                                    <button type="button" class="btn btn-default btn-xs" data-event="##:adminTableModel.congDownloadCsv::key##">CSV 出力</button>
                                </div>
                                <div class="btn-group pull-right" role="group">
                                    <button type="button" class="btn btn-default btn-xs" data-event="##:adminTableModel.congSetCong::key##">##=key##へ更新</button>
                                </div>
                            </CAPTION>
                            <thead>
                            <tr>
                                <th><input type="checkbox" value="##=key##" onclick="$(this).parents('table').find(':checkbox').prop('checked', this.checked);"></th>
                                <th>file.</th>
                                <th>処理ステータス</th>
                                <th>探し結果</th>
                                <th>既存有無</th>
                                <th>会衆 (登録内容➡マッチ)</th>
                                <th>住所</th>
                                <th>お名前</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!--
                            ##
                            for (var ind=0, size=congList.length; ind < size; ind++) {
                                var fdata = congList[ind];
                                //console.log(fdata);
                            ##
                            -->
                            <tr>
                                <td><input type="checkbox" value="##=ind##"></td>
                                <td>##=fdata.fileno##-##=fdata.serial##</td>
                                <td>##=fdata.findServiceCongStatus##</td>
                                <td>##=fdata.result##</td>
                                <td>##=fdata.isNew##</td>
                                <td>##=fdata.findServiceCong## ➡ ##=key##</td>
                                <td>##=fdata.findServiceAddress1 + fdata.findServiceAddress2 + fdata.findServiceAddress3 + fdata.findServiceAddress4 + fdata.findServiceAddress5##</td>
                                <td>##=fdata.findServiceName##</td>
                            </tr>
                            <!--##};##-->
                            </tbody>
                        </table>
                        <!--##}##-->
            	</div>
            </div>
            <div class="panel-body" style="height:calc(100% - 0px);margin-top:-25px;">
        		<div id="congEditPanel" class="congLayerPanel" style="position:absolute;z-index:5;left:260px;background-color:#fff;padding:4px;">
        		    <input type="text" id="congName" placeholder="会衆名" value="">
        		    <input type="color" id="congLayerColor" placeholder="色" value="">
                    <input type="button" id="setToCongLayer" data-event="##:congLayer.setToCongLayer::congLayer##" value="登録">
                    <input type="button" id="removeCongLayer" data-event="##:congLayer.removeCongLayer::congLayer##" value="削除">
                </div>
                <div class="congLayerPanel" style="position:absolute;z-index:5;left:600px;background-color:#fff;padding:4px;">
                    <input type="button" id="reloadGeoJson" data-event="##:congLayer.reloadGeoJson::congLayer##" value="reload from server">
                    <input type="button" id="mapGeoJsonExport" data-event="##:congLayer.saveGeoJson::congLayer##" value="save to server">
                </div>
                <div id="congMap" class="panel-heading" style="height:calc(100% - 0px);">
                </div>
            </div>
        </script>
    </div>
    
    <div class="container fitArea hidden" id="adminMapArea" style="height: 100%; position: absolute; height:calc(100% - 52px); width: 100%; margin-top: -18px;">
        
        <div style="position:fixed;z-index:100;width:400px;right:0px;opacity:0.7;top:52px;bottom:20px;" id="adminMapPanelArea">
            <script type="text/tmpl" data-tmpl-id="adminMapPanelArea" data-tmpl-option='{"render": true}'>
            <div class="collapse in" id="adminMapPanel" style="height:100%">
                <div class="panel panel-default" style="margin-bottom:0px;height:100%">
                    <div class="panel-heading">
                        全件:<span class="badge" id="adminMapPanelTotalCount">0</span>
                        チェック有:<span class="badge" id="adminMapPanelCount">0</span>
                        更新完了:<span class="badge" id="adminMapPanelUpdateCount">0</span>
                        
                        <button class="btn btn-default" type="button" data-event="##:{click:function(e) {
                            $("#adminMapPanelList li :checkbox").prop('checked', true);
                        }}##">すべて選択</button>
                        <div class="input-group">
                            <span class="input-group-addon" id="adminMapPanelSearchFileNoCount">0</span>
                            <input type="text" class="form-control" placeholder="区域番号" id="adminMapPanelSearchFileNo" data-event="##:{click:findServiceModel.searchFileNo, keyup:findServiceModel.searchFileNo}##">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button" data-event="##:{click:function(e) {
                                    findServiceModel.adminMap.fitBounds(findServiceModel.adminMapSearchBounds);
                                }}##">検索</button>
                            </span>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="区域番号" id="adminMapPanelFileNo">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button" data-event="##:findServiceModel.saveFileNo##">登録</button>
                            </span>
                        </div>
                    </div>
                    <ul class="list-group" id="adminMapPanelList" style="height:calc(100% - 153px);overflow-y:auto;">
                    </ul>
                </div>
            </div>

            <button class="btn btn-primary btn-xs" style="margin-left:330px" type="button" data-toggle="collapse" data-target="#adminMapPanel">管理パネル</button>
            </script>
        </div>
        
        <div id="adminMap" style="width:1123px; height:792px;">
            
        </div>

    </div>
<datalist id="findServiceMapKuList">
    <option value=""></option>
    <option value="横浜市鶴見区">横浜市鶴見区</option>
    <option value="横浜市神奈川区">横浜市神奈川区</option>
    <option value="横浜市西区">横浜市西区</option>
    <option value="横浜市中区">横浜市中区</option>
    <option value="横浜市南区">横浜市南区</option>
    <option value="横浜市保土ケ谷区">横浜市保土ケ谷区</option>
    <option value="横浜市磯子区">横浜市磯子区</option>
    <option value="横浜市金沢区">横浜市金沢区</option>
    <option value="横浜市港北区">横浜市港北区</option>
    <option value="横浜市戸塚区">横浜市戸塚区</option>
    <option value="横浜市港南区">横浜市港南区</option>
    <option value="横浜市旭区">横浜市旭区</option>
    <option value="横浜市緑区">横浜市緑区</option>
    <option value="横浜市瀬谷区">横浜市瀬谷区</option>
    <option value="横浜市栄区">横浜市栄区</option>
    <option value="横浜市泉区">横浜市泉区</option>
    <option value="横浜市青葉区">横浜市青葉区</option>
    <option value="横浜市都筑区">横浜市都筑区</option>
    <option value="川崎市川崎区">川崎市川崎区</option>
    <option value="川崎市幸区">川崎市幸区</option>
    <option value="川崎市中原区">川崎市中原区</option>
    <option value="川崎市高津区">川崎市高津区</option>
    <option value="川崎市多摩区">川崎市多摩区</option>
    <option value="川崎市宮前区">川崎市宮前区</option>
    <option value="川崎市麻生区">川崎市麻生区</option>

</datalist>
<datalist id="findServiceFindFromList">
    <option value=""></option>
    <option value="電話帳">
    <option value="ゼンリン">
    <option value="その他">
</datalist>
<datalist id="townNameList" class="br-tmpl">
    <script type="text/tmpl" data-tmpl-id="townNameList">
        <option value=""></option>
    ##for(var ind=0, town=data.town, size=town; ind < size; ind++) {##
        <option value="##=town[ind]##">
    ##}##
    </script>
</datalist>

    <div class="container" id="findService">
    	<div id="findServiceTable" class="panel panel-default br-tmpl">
		    <script type="text/tmpl" data-tmpl-id="findServiceTable">
        		<div class="panel-heading">
        		    探し記録
        		    
        		    <a href="http://ko.wikipedia.org/wiki/%EB%8C%80%ED%95%9C%EB%AF%BC%EA%B5%AD%EC%9D%98_%EC%9D%B8%EA%B5%AC%EC%88%9C_%EC%84%B1%EC%94%A8_%EB%AA%A9%EB%A1%9D" class="btn btn-default btn-sm" target="wiki1">韓国姓1</a>
        		    <a href="http://ko.wikipedia.org/wiki/%ED%95%9C%EA%B5%AD%EC%9D%98_%EC%84%B1%EC%94%A8_%EB%AA%A9%EB%A1%9D" class="btn btn-default btn-sm" target="wiki2">韓国姓2</a>
        		    
        		    
                    <button type="button" id="searchToggleButton" class="btn btn-default btn-sm pull-right" data-toggle="collapse" data-target="#searchArea">
                        <span class="glyphicon glyphicon-search">検索</span>
                    </button>
                    <button type="button" class="btn btn-default btn-sm pull-right ##=data.editMode=='new' || data.editMode=='no' ? 'hidden': ''##" data-event="##:findServiceModel.addNew##">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 新規追加
                    </button>
                    <button type="button" class="btn btn-default btn-sm pull-right ##=(!data.editMode) ? 'hidden': ''##" data-event="##:findServiceModel.listArea##">
                        <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> 一覧
                    </button>
                    <!--
                    <button type="button" class="btn btn-default btn-sm pull-right ##=(data.editMode) ? 'hidden': ''##" data-event="##:{
                                                        click:function(){
                                                            $('#matchData').toggleClass('hidden');
                                                        }}##">
                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span> 付け合わ
                    </button>
                    -->
        		</div>
        		
##if(data.mathcMode) {##
        		<div class="panel-body" id="matchData">
        		    <div class="row">
            		    <form class="form-inline">
                            <div class="form-group">
                                <label class="sr-only">検索住所</label>
                                <input type="text" class="form-control" style="width:100px" id="matchAddressInput1" placeholder="住所1" 
                                        value="##=data.findServiceAddress1##">
                                <input type="text" class="form-control" style="width:150px" id="matchAddressInput2" placeholder="住所2" 
                                        value="##=data.findServiceAddress2##">
                                <input type="text" class="form-control" style="width:120px" id="matchAddressInput3" placeholder="住所3" 
                                        value="##=data.findServiceAddress3##">
                                <input type="text" class="form-control" style="width:120px" id="matchAddressInput4" placeholder="住所4" 
                                        value="##=data.findServiceAddress4##">
                                <input type="text" class="form-control" style="width:200px" id="matchAddressInput5" placeholder="住所5" 
                                        value="##=data.findServiceAddress5##">
                                <input type="text" class="form-control" style="width:150px" id="matchAddressName" placeholder="名前" 
                                        value="##=data.findServiceName##" readonly>
                            </div>
                            <button type="button" class="btn btn-primary" data-event="##:{
                                                                    click:function(e){
                                                                        findServiceModel.matchAddress();
                                                                    }}##">検索</button>
                            <button type="button" data-event="##:findServiceModel.setToNew##" class="btn btn-default ##=(data.isNew==1) ? 'btn-success' : 'btn-default'##">新規</button>
            			    <button type="button" data-event="##:findServiceModel.setToDuplicate##" class="btn btn-default ##=(data.isNew==2) ? 'btn-success' : 'btn-default'##">既存</button>
                        </form>


        		    </div>
        		</div>
        		<div class="table-responsive">
            		<table class="table table-bordered" id="matchAddressTable">
                        <thead>
                            <tr class="active">
                                <th>class</th>
                                <th>住所</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
##}
if(data.editMode && data.editMode != 'no') {##
        		<div class="panel-body br-form">
                 	<div id="findServiceEditArea" class="form-edit panel-body" role="form">
            		    <input type="hidden" name="##=Bridge.idName##" value="##=data[Bridge.idName]##">

            			<div class="row">
                			<div class="form-group col-sm-4">
                				<label class="">登録日</label>
                				<input type="date" class="form-control" name="findServiceDate" value="##=data.findServiceDate##" placeholder="日付">
                			</div>
                		</div>
                		<div class="row">
                		    <div class="form-group col-sm-4">
                				<label class="">情報元</label>
            					<input type="text" name="findServiceFindFrom" list="findServiceFindFromList" value="##=data.findServiceFindFrom##" class="form-control"/>
                			</div>
                			<div class="form-group col-sm-4">
                				<label class="">地図:市区</label>
            				    <input type="text" name="findServiceMapKu" list="findServiceMapKuList" value="##=data.findServiceMapKu##" class="form-control">
                			</div>
                			<div class="form-group col-sm-4">
                				<label class="">ページ</label>
                				<div class="input-group">
            					    <input type="text" name="findServiceMapPage" list="findServiceMapPageList" value="##=data.findServiceMapPage##" class="form-control"/>
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="button" data-event="##:findServiceModel.clearField##">
                                            <span class="glyphicon glyphicon-erase" aria-hidden="true"></span>
                                        </button>
                                    </span>
                                </div>
                			</div>
                		</div>
                		<div class="row">
                			<div class="form-group col-sm-8">
                				<label class="">住所</label>
                				<div class="row">
                				    <div class="col-sm-6">
                				        <div class="input-group">
                				            <input type="text" id="findServiceAddress1" name="findServiceAddress1" value="##=data.findServiceAddress1 || '神奈川県'##" class="form-control" placeholder="都���府県"/>
                				            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" data-event="##:findServiceModel.clearField##">
                                                    <span class="glyphicon glyphicon-erase" aria-hidden="true"></span>
                                                </button>
                                            </span>
                				        </div>
                				    </div>
                				</div>
                				<div class="row">
                				    <div class="col-sm-6">
                				        <div class="input-group">
                				            <input type="text" list="findServiceMapKuList" id="findServiceAddress2" name="findServiceAddress2" value="##=data.findServiceAddress2##" class="form-control" placeholder="市区"/>
                				            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" data-event="##:findServiceModel.clearField##">
                                                    <span class="glyphicon glyphicon-erase" aria-hidden="true"></span>
                                                </button>
                                            </span>
                				        </div>
                				    </div>
                				</div>
                				<div class="row">
                				    <div class="col-sm-6">
                				        <div class="input-group">
                    				        <input type="text" list="townNameList" id="findServiceAddress3" name="findServiceAddress3" value="##=data.findServiceAddress3##" class="form-control" placeholder="町村"/>
                    				        <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" data-event="##:findServiceModel.clearField##">
                                                    <span class="glyphicon glyphicon-erase" aria-hidden="true"></span>
                                                </button>
                                            </span>
                                        </div>
                				    </div>
                				    <div class="col-sm-6">
                				        <div class="input-group">
                				            <input type="text" id="findServiceAddress4" name="findServiceAddress4" value="##=data.findServiceAddress4##" class="form-control" placeholder="番地"/>
                				            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" data-event="##:findServiceModel.clearField##">
                                                    <span class="glyphicon glyphicon-erase" aria-hidden="true"></span>
                                                </button>
                                            </span>
                				        </div>
                				    </div>
                				</div>
                				<div class="row">
                				    <div class="col-sm-12">
                				        <div class="input-group">
                				            <input type="text" id="findServiceAddress5" name="findServiceAddress5" value="##=data.findServiceAddress5##" class="form-control" placeholder="建物名"/>
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" data-event="##:findServiceModel.clearField##">
                                                    <span class="glyphicon glyphicon-erase" aria-hidden="true"></span>
                                                </button>
                                            </span>
                                        </div>
                			        </div>
                			    </div>
                			</div>
                			<div class="form-group col-sm-4">
                				<label for="findServiceName" class="">名前</label>
                				<div class="input-group">
                				    <input type="text" id="findServiceName" name="findServiceName" value="##=data.findServiceName##" class="form-control"/>
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="button" data-event="##:findServiceModel.clearField##">
                                            <span class="glyphicon glyphicon-erase" aria-hidden="true"></span>
                                        </button>
                                    </span>
                			    </div>
                			</div>
                		</div>
                        <div class="row">
                			<div class="form-group col-sm-12">
                				<label for="findServiceComment" class="">
                				    地図 <button data-event="##:findServiceModel.geocoding##" class="btn btn-primary btn-xs">地図で住所の場所を表示</button>
                				</label>
                				<div class="row">
                        		    <div class="form-group col-sm-4">
                        				<label class="">Lat.</label>
                    					<input type="text" id="findServiceLat" name="findServiceLat" value="##=data.findServiceLat##" class="form-control"/>
                        			</div>
                        		    <div class="form-group col-sm-4">
                        				<label class="">Lng.</label>
                    					<input type="text" id="findServiceLng" name="findServiceLng" value="##=data.findServiceLng##" class="form-control"/>
                        			</div>
                        		</div>
                				<span class="label label-warning">表示されている地図が正しいか確認していだだけると助かります</span>
                				<div id="map_canvas" style="width:100%; height:100%"></div>
                			</div>
                        </div>
                        <div class="row">
                			<div class="form-group col-sm-12">
                				<label for="findServiceComment" class="">コメント</label>
                				<textarea class="form-control" rows="3" id="findServiceComment" name="findServiceComment">##=data.findServiceComment##</textarea>
                			</div>
                        </div>
            		</div>
                    <nav class="navbar navbar-default navbar-fixed-bottom">
                        <div class="container">
                            <div class="navbar-header" style="padding:10px">
                                <div class="navbar-brand"style="height: 0px;"></div>
                                <div class="navbar-left">
                                    <button type="button" data-event="##:findServiceModel.save##" class="btn ##=data[Bridge.idName] ? 'btn-success' : 'btn-primary'## ">##=data[Bridge.idName] ? '修正' : '登録'##</button>
                                </div>
                                <div class="navbar-right">
                                    <button type="button" data-event="##:findServiceModel.restoreFromPrev##" class="btn btn-success ##=data.editMode != 'new' || !findServiceModel.savedData ? 'hidden': ''##">前回登録をコピー</button>
                                    <button type="button" data-event="##:findServiceModel.saveCancel##" class="btn">キャンセル</button>
                    		    </div>
                    		</div>
                        </div>
                    </nav>
        		</div>

##
}
if(data.list) {
##
        		<div class="panel-heading collapse" id="searchArea">
            		    <div class="form-inline">
            		    ##
            		    $.each(findServiceModel_searchForm, function(key, obj) {
            		        if (obj.lineBreak) {
            		    ##
                		</div>
                		<div class="form-inline">
                		    ##}##
                            <div class="form-group">
                                <label class="">##=obj.label##</label>
                                <input type="##=obj.type || 'text'##" id="##=key##" list="##=obj.list##" value="##=data.search[key]##" class="form-control input-sm" style="##=obj.style##"/>
                			</div>
            		    ##});##
                    		<div class="form-group">
                    		    <select id="search_isNew" class="form-control input-sm" value="##=data.search.search_isNew##">
                    		        <option value="">-新規有無-</option>
                    		        ##$.each(findServiceModel_isNew, function(key, obj) {##
                    		            <option value="##=key##" ##=data.search.search_isNew == key ? 'selected="selected"' : ""##>##=obj.label##</option>
                    		        ##});##
                                </select>
                            </div>	
                    		<div class="form-group">
                    		    <select id="search_result" class="form-control input-sm" value="##=data.search.search_result##">
                    		        <option value="">-結果-</option>
                    		        ##$.each(findServiceModel_resultTypeModel, function(key, obj) {##
                    		            <option value="##=key##" ##=data.search.search_result == key ? 'selected="selected"' : ""##>##=obj.label##</option>
                    		        ##});##
                                </select>
                            </div>
                    		<div class="form-group">
                    		    <select id="search_findServiceCongStatus" class="form-control input-sm" value="##=data.search.search_findServiceCongStatus##">
                    		        <option value="">-処理状況-</option>
                    		        ##$.each(findServiceModel_findServiceCongStatus, function(key, obj) {##
                    		            <option value="##=key##" ##=data.search.search_findServiceCongStatus == key ? 'selected="selected"' : ""##>##=obj.label##</option>
                    		        ##});##
                                </select>
                            </div>

                			<button class="btn btn-default" type="submit" data-event="##:findServiceModel.search##">検索</button>
            			</div>
            			<div class="form-inline">
                            <div class="btn-group pull-right">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    処理状態を変更 <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a href="javascript:void(0);" data-event="##:findServiceModel.congSetStatus::['ダウンロード済み']##">ダウンロード済み</a></li>
                                    <li><a href="javascript:void(0);" data-event="##:findServiceModel.congSetStatus::['地元会衆へ連絡']##">地元会衆へ連絡</a></li>
                                    <li><a href="javascript:void(0);" data-event="##:findServiceModel.congSetStatus::['処理完了']##">処理完了</a></li>
                                    <li><a href="javascript:void(0);" data-event="##:findServiceModel.congSetStatus::['ステータスをクリア']##">ステータスをクリア</a></li>
                                </ul>
                            </div>
            			</div>

        		</div>
                <div class="panel-pagenation">
            		<nav>
                        ##@Bridge.tmplTool.include('/tmpl/tmpl.pagenation.html', 'pagination')##
                    </nav>
                </div>
        		<div class="table-responsive">
            		<table class="table table-bordered" id="searchedMainTable">
                        <thead>
                            <tr class="active">
                                ##
                                    data.orderBy = data.orderBy || {};
                                    var changePattern = {'undefined' : 1, '1' : -1, '-1': undefined};
                                    var sortEvent = {click: function(e) {
                                        var sortValue = data.orderBy[e.data];
                                        findServiceModel.orderBy[e.data] = changePattern[sortValue];
                                        findServiceModel.listAreaReset();
                                    }};
                                    var sortIcon = function(field) {
                                        var sortObj = data.orderBy[field];
                                        if (!sortObj) {
                                            return '';
                                        }
                                        return '<span class="glyphicon glyphicon-sort-by-attributes' + (sortObj == 1 ? '': '-alt') + '"></span>';
                                    }
                                if(findServiceModel.getAuth(1)) {##
                                <th><input type="checkbox" onclick="$(this).parents('table').find(':checkbox').prop('checked', this.checked);"></th>
            					##}##
            					<th style="width:92px;">総計:##=data.listCount##</th>
            					<th data-event="##:sortEvent::'result'##">確認記録 ##=sortIcon('result')##</th>
                                <th data-event="##:sortEvent::'findServiceDate'##" width="90px">登録日 ##=sortIcon('findServiceDate')##</th>
                                <th data-event="##:sortEvent::'findServiceFindFrom'##">情報元 ##=sortIcon('findServiceFindFrom')##</th>
                                <th data-event="##:sortEvent::'fileno'##" style="min-width:45px">区域番号 ##=sortIcon('fileno')##</th>
                                <th data-event="##:sortEvent::'findServiceAddress1'##">住所 ##=sortIcon('findServiceAddress1')##</th>
                                <th data-event="##:sortEvent::'findServiceName'##">名前 ##=sortIcon('findServiceName')##</th>
            					<th data-event="##:sortEvent::'findServiceComment'##" style="width:370px">コメント ##=sortIcon('findServiceComment')##</th>
            					##if(findServiceModel.getAuth(1)) {##
            					<th data-event="##:sortEvent::'first_update_name'##" style="min-width:45px">登録者 ##=sortIcon('first_update_name')##</th>
            					##}##
                            </tr>
                        </thead>
                        <tbody>
            				##
            				totalData={};
            				$.each(data.list || {} , function(ind, obj) {
            				##
                            <tr class="##=(commonModel._id == obj.first_update_user || commonModel._id == obj.last_update_user) ? '' : ''##">
            					##
            					totalData.findServiceTotalCount = totalData.findServiceTotalCount ? totalData.findServiceTotalCount + 1 : 1;
                                if(findServiceModel.getAuth(1)) {##
            					<td><input type="checkbox" value="##=obj._id##"><span>##=obj.findServiceCongStatus##</span></td>
            					##}##
                                <td>
                                    ##if (commonModel._id == obj.first_update_user  || findServiceModel.getAuth(1)) {##
            						<button data-ind="##=ind##" data-id="##=obj[Bridge.idName]##" data-event="##:findServiceModel.lineEdit##" class="btn btn-default btn-xs">修正</button>
            						<button data-event="##:findServiceModel.lineDelete##" class="btn btn-default btn-xs">削除</button>
            					    ##}##
            					    <button data-event="##:findServiceModel.setToNew##" class="btn btn-xs ##=(obj.isNew==1) ? 'btn-success' : 'btn-default'##" ##if(!findServiceModel.getAuth(1)) {## disabled="disabled" ##}##>新規</button>
            					    <button data-event="##:findServiceModel.setToDuplicate##" class="btn btn-xs ##=(obj.isNew==2) ? 'btn-warning' : 'btn-default'##" ##if(!findServiceModel.getAuth(1)) {## disabled="disabled" ##}##>既存</button>
            					</td>
            					<td>
            					    <div class="btn-group">
                                        
                                        <button type="button" class="btn ##=findServiceModel_resultTypeModel[obj.result || 0].color## btn-xs dropdown-toggle" data-event="##:findServiceModel.openVisit##">
                                            ##=findServiceModel_resultTypeModel[obj.result || 0].label## <span class="caret"></span>
                                        </button>
                                        
                                        <!--
                					    <button type="button" class="btn ##=findServiceModel_resultTypeModel[obj.result || 0].color## btn-xs dropdown-toggle" data-toggle="dropdown">
                                            ##=findServiceModel_resultTypeModel[obj.result || 0].label## <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" role="menu">
                                            <li><a href="#" data-event="##:findServiceModel.setResult##" data-resultType="1" class="##=(obj.result==1) ? 'btn-success' : 'btn-default'##">韓国語</a></li>
                                            <li><a href="#" data-event="##:findServiceModel.setResult##" data-resultType="2" class="##=(obj.result==2) ? 'btn-info' : 'btn-default'##">日本語</a></li>
                                            <li><a href="#" data-event="##:findServiceModel.setResult##" data-resultType="3" class="##=(obj.result==3) ? 'btn-info' : 'btn-default'##">中国語</a></li>
                                            <li class="divider"></li>
                                            <li><a href="#" data-event="##:findServiceModel.setResult##" data-resultType="-1" class="##=(obj.result==-1) ? 'btn-warning' : 'btn-default'##">あいまい</a></li>
                                            <li><a href="#" data-event="##:findServiceModel.setResult##" data-resultType="-2" class="##=(obj.result==-2) ? 'btn-danger' : 'btn-default'##">住所不明</a></li>
                                            <li><a href="#" data-event="##:findServiceModel.setResult##" data-resultType="0" class="##=(!obj.result || obj.result==0) ? 'btn-info' : 'btn-default'##">未設定</a></li>
                                        </ul>
                                        -->
                                    </div>
            					</td>
                                <td>##=obj.findServiceDate##</td>
                                <td>##=obj.findServiceFindFrom## ##=obj.findServiceMapKu## ##=obj.findServiceMapPage##</td>
                                <td>##=obj.fileno##-##=obj.serial##</td>
                                <td>
                                    ##if(findServiceModel.getAuth(1)) {##
                                    <button type="button" class="btn btn-default btn-xs" data-event="##:{click:function(e){
                                            Bridge.tmplTool.render('findServiceTable', Bridge.extend(e.data, {mathcMode: true, editMode: 'no'}));
                                            findServiceModel.matchAddress();
                                            //$('#matchAddressInput').val(data.findServiceAddress1 + data.findServiceAddress2 + data.findServiceAddress3 + data.findServiceAddress4);
                                        }}##">
                                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                    </button>
                                    &nbsp;
                                    ##}##
                                    ##=(!obj.findServiceLat || !obj.findServiceLng ? '※' : '')##
                                    <a href="http://maps.google.co.jp/maps?q=##=(obj.findServiceLat && obj.findServiceLng) ? 'loc:' + obj.findServiceLat + ',' + obj.findServiceLng :  obj.findServiceAddress1 + obj.findServiceAddress2 + obj.findServiceAddress3 + ' ' + obj.findServiceAddress4##" target="gmap">
                                        ##=obj.findServiceAddress1####=obj.findServiceAddress2####=obj.findServiceAddress3####=obj.findServiceAddress4## ##=obj.findServiceAddress5##
                                    </a>
                                </td>
                                <td>##=obj.findServiceName##</td>
            					<td>
            					    ##
            					    var comments = obj.findServiceVisitHistory || {};
            					    var comment = null;
            					    for(var key in comments) {
            					        comment = comments[key];
            					    ##
            					        <div>
            					            ##=comment.visitDate || comment.last_update_date || comment.first_update_date##
            					            ##=findServiceModel_visitResultInfo[comment.visitResult]##
            					            ##=findServiceModel_resultTypeModel[comment.result || 0].label##
            					            ##=comment.comment##
            			                </div>
            				        ##}##
            					</td>
            					##if(findServiceModel.getAuth(1)) {##
            					<td>##=obj.first_update_name##</td>
            					##}##
                            </tr>
                            ##});##
                        </tbody>
                        <tfoot>
                            <tr class="active">
            					<th>表示:##=totalData.findServiceTotalCount##</th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
            					##if(findServiceModel.getAuth(1)) {##
            					<th></th>
            					<th></th>
            					##}##
                            </tr>
                        </tfoot>
            		</table>
            	</div>
            	<div class="panel-pagenation bottom">
            		<nav>
            		    ##@Bridge.tmplTool.include('/tmpl/tmpl.pagenation.html', 'pagination')##
                    </nav>
                </div>
##}##
		    </script>
		</div>
    </div>
    
    <div id="loadingModal" class="modal" data-keyboard="false" tabindex="-1" role="dialog" data-bind-tmpl-id="loadingBar" data-tmpl-src="./tmpl/tmpl.common.html">
    </div>
    
    <div class="modal" id="searchedMapModal" data-backdrop="true">
        <script type="text/tmpl" data-tmpl-id="searchedMapModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">##=data.findServiceAddress2 + data.findServiceAddress3 + data.findServiceAddress4 + ' ' + data.findServiceAddress5+ ' ' + data.findServiceName##</h4>
                </div>

                <div class="list-group">
                    ##
                    $.each(data.findServiceVisitHistory || [], function(ind, obj) {##
                    <a href="#" class="list-group-item" data-toggle="collapse" data-target="#visitCollapse##=ind##" style="margin-right:40px;">
                        ##=obj.visitDate || obj.last_update_date || obj.first_update_date##
                        ##=findServiceModel_visitResultInfo[obj.visitResult]##
                        <span class="visit-right-side">
                            ##=obj.last_update_name##
                            <button type="button" class="btn btn-default" data-ind="##=ind##" data-event="##:findServiceModel.removeVisit::data##">
                                <span class="glyphicon glyphicon glyphicon-remove-sign" data-ind="##=ind##"></span>
                            </button>
                        </span>
                    </a>
                    <div class="collapse list-group-item br-form" id="visitCollapse##=ind##">
                        <!--<input type="hidden" name="##=Bridge.idName##" value="##=data[Bridge.idName]##">-->
                        ##if (obj.result != undefined) {##
                        <div class="row">
            			    <div class="form-group col-sm-12">
            			        ##=findServiceModel_resultTypeModel[obj.result].label## へ変更
                            </div>
                        </div>
        			    ##}
        			      if (obj.comment != undefined) {
        			        var buttonClickAble = function() {
        			            $('#searchedMapModalSubmitButton' + ind).removeClass('disabled');
        			        }
        			    ##
                        <div class="row form-inline">
                            <div class="form-group col-sm-6">
                                <label class="">確認日</label>
                                <input type="date" name="visitDate" value="##=obj.visitDate##" class="form-control input-sm" style="width:160px;" data-event="##:{change: buttonClickAble}##">
                			</div>
                			<div class="form-group col-sm-6">
                    			<div class="btn-group pull-right" data-toggle="buttons">
                                    <label class="btn btn-default">
                                        <input type="radio" name="visitResult" value="2" data-event="##:{change: buttonClickAble}##"> 不在
                                    </label>
                                    <label class="btn btn-default">
                                        <input type="radio" name="visitResult" value="1" data-event="##:{change: buttonClickAble}##"> 会えた
                                    </label>
                                </div>
                            </div>
            			</div>
                        <div class="row">
            			    <div class="form-group col-sm-12">
            				    <label class="">コメント</label>
            				    <textarea class="form-control" rows="5" name="comment" data-event="##:{keydown: buttonClickAble}##">##=obj.comment##</textarea>
            			    </div>
                        </div>
                        <div class="row">
            			    <div class="form-group col-sm-12">
            			        <button type="submit" id="searchedMapModalSubmitButton##=ind##" class="btn btn-primary disabled" data-ind="##=ind##" data-event="##:findServiceModel.saveVisit::data##">修正</button>
            			    </div>
                        </div>
                        ##}##
                    </div>
                    ##})##
                    
                    <a href="#" class="list-group-item" data-toggle="collapse" data-target="#visitCollapseNew">
                        新規登録
                    </a>
                    <div class="collapse in list-group-item br-form" id="visitCollapseNew">
                        <div class="row form-inline">
                            <div class="form-group col-sm-6">
                                <label class="">確認日</label>
                                <input type="date" name="visitDate" value="" class="form-control input-sm" style="width:160px;">
                			</div>
                			<div class="form-group col-sm-6">
                    			<div class="btn-group pull-right" data-toggle="buttons">
                                    <label class="btn btn-default">
                                        <input type="radio" name="visitResult" value="2"> 不在
                                    </label>
                                    <label class="btn btn-default">
                                        <input type="radio" name="visitResult" value="1"> 会えた
                                    </label>
                                </div>
                            </div>
            			</div>
                        <div class="row">
            			    <div class="form-group col-sm-12">
            				    <label class="">コメント</label>
            				    <textarea class="form-control" rows="5" name="comment"></textarea>
            			    </div>
                        </div>
                        <div class="row">
            			    <div class="col-sm-12">
            			        <button type="submit" id="searchedMapModalSubmitButtonNew" class="btn btn-primary" data-ind="new" data-event="##:findServiceModel.saveVisit::data##">登録</button>
            			    </div>
                        </div>
                    </div>
                    
                </div>

                <div class="modal-footer">
                  	##$.each(findServiceModel_resultTypeModel, function(key, obj) {##
                  	    <button type="button" class="btn btn-xs ##=(data.result==key) ? obj.color : 'btn-default'##" data-event="##:findServiceModel.setResult::data##" data-resultType="##=key##" data-fromMap="true">##=obj.label##</button>
                    ##});##
                </div>
          
            </div><!-- /.modal-content -->

        </div><!-- /.modal-dialog -->
        </script>
    </div><!-- /.modal -->
    
    <div class="modal" id="csvExportModal" data-backdrop="true">
        <script type="text/tmpl" data-tmpl-id="csvExportModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">CSVダウンロード</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
        			    <div class="form-group col-sm-12">
        				    <label class="">TRTR出力順</label>
        				    <textarea class="form-control" rows="5" id="trtrCsvExportHeader">id,fileno,new_fileno,serial,notice,lastvisit,class,lat,lng,congregation,zipcode,prefecture,cityward,town,chome,banchi,gou,address2,name,tel,description,phonetic_town</textarea>
        			    </div>
                    </div>
                    <div class="row">
        			    <div class="form-group col-sm-12">
        				    <label class="">探し出力順</label>
        				    <textarea class="form-control" rows="5" id="findServiceCsvExportHeader">_id,fileno,isNew,result,findServiceDate,findServiceFindFrom,findServiceMapKu,findServiceMapPage,findServiceAddress1,findServiceAddress2,findServiceAddress3,findServiceAddress4,findServiceAddress5,findServiceName,findServiceLat,findServiceLng,findServiceComment,first_update_name,first_update_user,first_update_date,last_update_name,last_update_user,last_update_date</textarea>
        			    </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-event="##:findServiceModel.toCsv::2##">TRTR + 探し</button>
                    <button type="button" class="btn btn-primary" data-event="##:findServiceModel.toCsv::1##">探しのみ</button>
                </div>
            </div>
        </div>
        </script>
    </div>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDejNEedWnONLDewIynvzf6Wv-aI4sd3eU&amp;sensor=true&amp;libraries=drawing"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script src="js/jquery-2.1.0.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/underscore.js"></script>
<script src="js/bridge.core.js"></script>
<script src="js/bridge.date.js"></script>
<script src="js/bridge.router.js"></script>
<script src="js/app.js"></script>
<script src="js/congKml.js"></script>
<script src="js/findservice.config.js"></script>
<script src="js/findservice.js"></script>
<script src="js/findservice.adminTable.js"></script>


<script type="text/javascript">
    Bridge.tmplTool.bindTmpl($('[data-bind-tmpl-id]'));
    Bridge.tmplTool.addTmpl($('[data-tmpl-id]'), true);
    Bridge.tmplTool.render('menu', {});

    google.load("visualization", "1", {packages:["corechart", "bar", "table"]});
    
    var kanagwa_town = Bridge.localStorageTool.get('kanagwa_town');
    if (!kanagwa_town) {
        var kanagwaConn = new Bridge.Connector({dataName : "kanaga14",
            //url: navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/) ? "https://bridge-c9-choish.c9.io/bridge" : "/bridge"});
            url: navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/)
                     ?  ((document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1) ? "https:" : "") + "//ykcform.herokuapp.com/bridge" : "/bridge"});
        
        kanagwaConn.reqDistinct('town', 'town_name', {$or: [{city_name: {$regex : '川崎市'}}, {city_name: {$regex : '横浜市'}}]}).request(function(data, textStatus, jqXHR) {
            if (data.error) {
                return;
            }
            Bridge.localStorageTool.push('kanagwa_town', data);
            Bridge.tmplTool.render('townNameList', data);
        });
    } else {
        Bridge.tmplTool.render('townNameList', kanagwa_town);
    }

    var Workspace = Bridge.Router.extend({
    
        routes: {
            "":                     "index",
            "adminPanel":                "adminPanel",
            //"search/:query":        "search",  // #search/kiwis
            //"search/:query/p:page": "search",   // #search/kiwis/p7
            "_id/:id":                 "searchById",
            "search/(addr3/:address3)(/addr2/:address2)(/addr1/:address1)(/isNew/:isNew)(/result/:result)": "searchByAddress",
            "bounds/sn/:sw/ne/:ne(/isNew/:isNew)(/result/:result)": "searchByBounds",
            "*path":                     "index",
        },
        
        index: function() {
            Bridge.sessionStorageTool.push('search_findService', {});
            findServiceModel.listAreaReset();
        },
        
        help: function() {
            console.log('help');
        },
        
        search: function(searchParm, searchField) {
           //console.log('search');
            
            findServiceConn.reset()
                .reqCount('count', searchParm.$query)
                .reqList('reqList', searchParm)
                //.reqList('reqList', searchParm)
                .request(function(data, textStatus, jqXHR) {
                    findServiceModel.listCount = data['count'];
                    findServiceModel.listData = data['reqList'];
                    data.list = data['reqList'];
                    data.listCount = data['count'];
                    commonModel.messageAreaReset(data);
                    
                    data.search = searchField;
                    data.page = findServiceModel.page;
                    Bridge.tmplTool.render('findServiceTable', data);
            });
        },
        searchById: function(id) {
            var searchParm = {$query: {'_id': id}, $orderby: {findServiceDate : -1}};
            this.search(searchParm, {
                    pageSize: 1000,
                    pageNum: 1,
                    pageWidth: 4,
                    pageSelectFunc: findServiceModel.pageSelect,
                    pageSizeChangeFunc: findServiceModel.pageSizeChange
            });
        },
        searchByAddress: function(address3, address2, address1, isNew, result) {
            var search_findService = {
                "search_findServiceCityward": address2,
                "search_findServiceTown": address3,
                "search_isNew": isNew,
                "search_result": result
            }
    		Bridge.sessionStorageTool.push('search_findService', search_findService);
    		findServiceModel.listAreaReset();
        },
        searchByBounds: function(sw, ne, isNew, result) {
            var swArry = sw.split('|');
            var neArry = ne.split('|');
    
            var searchParm = {$query: { $and : [{'findServiceLat': { $gt: swArry[0], $lt: neArry[0] }}
                                              , {'findServiceLng': { $gt: swArry[1], $lt: neArry[1] }}]}
                                     , $orderby: {findServiceDate : -1}};
    
    		if (isNew) {
    		    if (isNew == 0) {
    		        searchParm.$query.$and.push({'$or': [{isNew : {$exists : false}}, {isNew : {$eq : 0}}, {isNew : {$eq : '0'}}]});
    		    } else {
    		        searchParm.$query.$and.push({'isNew': {$eq : parseInt(isNew)}});
    		    }
    		}
    		if (result) {
    		    if (result == 0) {
    		        searchParm.$query.$and.push({'$or': [{result : {$exists : false}}, {result : {$eq : 0}}]});
    		    } else {
    		        searchParm.$query.$and.push({'result': {$eq : parseInt(result)}});
    		    }
    		}
            this.search(searchParm, {
                    pageSize: 1000,
                    pageNum: 1,
                    pageWidth: 4,
                    pageSelectFunc: findServiceModel.pageSelect,
                    pageSizeChangeFunc: findServiceModel.pageSizeChange
            });
        },
        adminPanel: function() {
            adminTableModel.showAdminTable.click();
        }
    });
    var router = new Workspace().start();
    
    
    $('#searchedMapModal').on('hidden.bs.modal', function (e) {
        if (findServiceModel.selectedMapMarker) {
            findServiceModel.selectedMapMarker.setIcon(null);
        }
    });
    




    /*
    .draggable({
        handle: ".modal-header"
    });
    */

    /*
    $('#searchedMapModal').delegate(".modal-content", "load",  function() {
        alert*('ddd');
      $('#searchedMapModal .modal-content').position({
      my: "right bottom",
      at: "right bottom",
      of: "#searchedMap"
    });
    });
    */
        //if (Bridge.localStorageTool.get('keepLogin')) {
        //    commonModel.loginChecker();
        //} else {
        //    location.href = "/";
        //}
    </script>
</body>
</html>